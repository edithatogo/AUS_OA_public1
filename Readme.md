---
title: "Readme"
author: "AUS-OA Manual"
format: gfm

editor: visual
---

## Introduction

AUS-OA, a dynamic discrete time microsimulation model of osteoarthritis and its treatment in Australia. AUS-OA aims to provide policy makers and researchers with increased capacity to evaluate the burden and treatment of osteoarthritis across Australia.

## Folder structure

The folders are structured as follows:

-   **input:** Contains all inputs to the model. It has the following sub-folders:

    -   **population:** Contains base population (from HILDA) and the synthetic populations generated by the model for each year.

    -   **scenarios:** Contains excel sheets with all model parameters and simulation specifications. (See [Running simulations] for how to create and run a scenario).

-   **output:** All model output is saved to the output folder. It contains the following sub-folders.

    -   **log:** This sub-folder contains summary reports. There are two main reports generated by the model - "Simulation_results" and "Validation". The former contains summary statistics over time for key variables. The latter contains comparisons between simulated and observed data to validate the model.

    -   **model_stats:** Summary statistics generated by the simulation are saved in this folder into specific csv files.

    -   **raw_output:** The attribute matrix (with individual data) is saved in this folder.

    -   **figures:** The figures generated by the reports (saved in the "log") folder are also saved seperately in sub-folders located here. Each sub-folder within the "figures" is titled by the scenario name.

    -   **supplementary_materials:** This sub-folder is stand-alone and seperate from the main simulation. It contains figures and csv files for the supplementary section of the paper.

-   **scripts:** Contains model code. (See Section 3. For more details on the model).

-   **supporting_data:** This folder contains raw and cleaned data for various statistics used to validate the model.

## Running simulations

### Simulation basics

The model is designed for the user to specify a scenario with inputs of their choice and run simulations. To do that, the user must first make a copy of the simulation input file as follows.

1.  Go to `\input\scenarios\` and create a copy of the `ausoa_input_test.xlsx` file. Change the last part of the file name ("\_test") to a specific scenario name (e.g. \_scenario1). All output from the simulation will be saved with that suffix in the file name.

2.  Open the new input sheet and change any parameters or simulation options as needed.

3.  Open the AUS-OA project in R and navigate to `\scripts\00_AUS_OA_Master.R` script.

4.  Run the code. You will be prompted to choose input file. Choose the input file of your choice (e.g. `ausoa_input_scenario1.xlsx`). The script will then run and generate the output files and save them in the output folder (see [Folder structure]).

### Probabilistic and deterministic modes

The model can be run as a single round deterministic run with specified coefficients. Alternatively, in the input sheet, you can specify a probabilistic run by setting Probabilistic to TRUE. Then you can specify the rounds of monte-carlo simulations ("Number of simulations").

### Start year

The base year for the model is 2013. You can specify the start year in the input sheet to 2013 or any year afterwards. However, if population files do not exist for a given start year, you would need to first run a simulation in deterministic mode from 2013 until your specific start year to generate the population for that respective year.

## Overview of the model code

This section provides a brief overview of the model code.

In order to run the model, you need to run the script "00_AUS_OA_Master.R".

The script runs a few processes:

### 1. Pre-processsing

-   First, it reads in the setup parameters from the csv file described above.

-   Then it determines if it needs to generate the base population. If true, it runs "00_PREP_Synthetic_population.R".

-   The generated synthetic population is saved in `"input/population/"` with the specified "Simpop file" name in the setup csv file.

-   The code then runs `"01_AUS_OA_Setup_attribute_matrix.R"` where the base attribute matrix "am" is saved as a parquet file. This saves the model from going through the setup code each time we run a simulation (especially in parallelized runs).

-   The code then checks if the validation data has been extracted and cleaned. If not, the script `"00_PREP_Validation_data.R"` is run to extract and cleaned observed data to check with simulated data. Validation data are saved in `"supporting_data/Cleaned_validation_data_{variable name}.csv"` .

### 2. Run model

-   The model is then run by executing the script `"02_AUS_OA_Run_model.R"` . The main output object from the runs is a list "sim_storage" which contains the attribute matrix "am" for each year combined into one matrix per run. In a deterministic run, the list will contain one matrix. In a probabilistic run, there will be as many matrices as the number of simulation runs.

### 3. Compile statistics

-   Once the model is run, the `"00_AUS_OA_Master.R` " script calls `"03_AUS_OA_Compile_model_statistics.R"` . The latter takes the `sim_storage` list, and compiles the means, frequencies and standard deviation of each variable. It then stores the results from each run and year, and computes the mean across all runs and respective confidence intervals at 5% level.

-   The results are stored in a data-frame `"Model_stats"`. Then, the simulation parameters are added on to the data-frame so that you can know the model parameters that were used to generate the results. The results are then saved in `"output/model_stats/AUS_OA_Results_{scenario}.parquet`".

### 4. Model validation

Once model statistics are compiled, the R markdown script `"04_AUS_OA_Validate_model.Rmd"` executes code to compare observed with simulated data. The output is saved in `"output/logs/AUS_OA_Validation_{scenario}.html"` .

### 5. Simulation results

Finnaly, `'00_AUS_OA_Master.R'` runs the markdown script `"05_AUS_OA_Simulation_results.Rmd"` that plots time trends by age and sex for key variables, and provide key summary statistics. The summary statistics are saved in `"output/model_stats/AUS_OA_Clean_Summary_statistics_{scenario}.csv"` . The script generates a report ``` "output/log/``AUS_OA_Simulation_results_{scenario}.html" ``` . All graphs that are produced in the script are saved in `"output/figures/"` within a sub-folder with the scenario name.

The raw data from the attibute matrix is saved in `"output/raw_output/AUS_OA_Raw_output_{scenario}.csv"` . Further, the attribute matrix for each year is saved in `"input/population/"` if the simulation is run in deterministic mode.

## Testing

This project currently does not include automated tests. Running `make test` will simply print a message indicating that no tests are available.
